<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HSMA - Geographic Modelling and Visualisation - 32&nbsp; Boundary Problems - Creating and Evaluating Simple Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./boundary_problems_refining_solutions.html" rel="next">
<link href="./boundary_problems_visualising_historical_boundaries.html" rel="prev">
<link href="./resources/logos/hsma_logo_transparent_background_large.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="include/webex.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">HSMA - Geographic Modelling and Visualisation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hsma-programme/hsma6_geographic_optimisation_and_visualisation_book"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./boundary_redrawing_problems_intro.html">Part 6 - Working with Boundaries</a></li><li class="breadcrumb-item"><a href="./boundary_problems_varying_evaluating_simple.html"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Boundary Problems - Creating and Evaluating Simple Solutions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./resources/logos/hsma_logo_transparent_background_large.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Welcome!</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./what_geographic_problems_health_etc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Types of Geographic Problems</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Part 1 - Geographic Concepts and Terms</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./concepts_and_terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geographical Concepts and Terminology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ct_crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Projections and Coordinate Reference Systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ct_filetypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Geographic Data Filetypes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./the_importance_of_standardisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Standardisation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part 2 - Mapping in QGIS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction_mapping_with_qgis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Mapping in QGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting QGIS Ready to Use</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_basemaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Adding a basemap in QGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_point_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Visualising Point Data in QGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_choropleth.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Creating Choropleths in QGIS - Importing Boundaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_choropleths_joining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Choropleths in QGIS - Joining Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Filtering Data in QGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_print_layouts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Print Layouts in QGIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./qgis_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Exercises - QGIS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part 3 - Mapping in Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./why_python_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Why use python for maps?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_geopandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Working With Travel Time Data in Python - the geopandas package</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_geopandas_reading_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Reading files with Geopandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_geopandas_matplotlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Static Maps with Matplotlib</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_geopandas_folium_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Interactive Maps - Setting Up</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_geopandas_folium_point_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Interactive Maps - Point Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python_geopandas_folium_choropleths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Interactive Maps - Choropleths</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Part 4 - Working with Travel Times</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mapping_travel_times.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">What aspects can travel times help me with?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mtt_mapping_travel_times_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Visualising Travel Times in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mtt_travel_time_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Lookup Up Travel Times Using APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./valhalla_api_isochrones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Using Other APIs with RoutingPy - Valhalla</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Part 5 - Facility Location Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_facility_location.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">An Introduction to Facility Location Problems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fl_site_combinations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Calculating combinations of sites</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fl_problems_coding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Using code to solve facility location problems</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Part 6 - Working with Boundaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boundary_redrawing_problems_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Boundary Problems - An Initial Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boundary_problems_visualising_historical_boundaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Loading and Visualising the Historical Boundaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boundary_problems_varying_evaluating_simple.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Boundary Problems - Creating and Evaluating Simple Solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boundary_problems_refining_solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">(WIP) Boundary Problems - Refining Solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boundary_problems_multiobjective_optimisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">(Coming Soon) Boundary Problems - Evaluating Solutions on Multiple Metrics</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#generating-and-representing-new-boundaries" id="toc-generating-and-representing-new-boundaries" class="nav-link active" data-scroll-target="#generating-and-representing-new-boundaries"><span class="header-section-number">32.1</span> Generating and representing new boundaries</a>
  <ul class="collapse">
  <li><a href="#the-process" id="toc-the-process" class="nav-link" data-scroll-target="#the-process"><span class="header-section-number">32.1.1</span> The Process</a></li>
  <li><a href="#our-starting-dataframe" id="toc-our-starting-dataframe" class="nav-link" data-scroll-target="#our-starting-dataframe"><span class="header-section-number">32.1.2</span> Our starting dataframe</a></li>
  <li><a href="#getting-the-neighbours" id="toc-getting-the-neighbours" class="nav-link" data-scroll-target="#getting-the-neighbours"><span class="header-section-number">32.1.3</span> Getting the Neighbours</a></li>
  <li><a href="#making-a-dictionary-of-the-existing-allocations" id="toc-making-a-dictionary-of-the-existing-allocations" class="nav-link" data-scroll-target="#making-a-dictionary-of-the-existing-allocations"><span class="header-section-number">32.1.4</span> Making a dictionary of the existing allocations</a></li>
  <li><a href="#generating-starting-allocations" id="toc-generating-starting-allocations" class="nav-link" data-scroll-target="#generating-starting-allocations"><span class="header-section-number">32.1.5</span> Generating starting allocations</a></li>
  <li><a href="#generating-our-new-regions" id="toc-generating-our-new-regions" class="nav-link" data-scroll-target="#generating-our-new-regions"><span class="header-section-number">32.1.6</span> Generating our new regions</a></li>
  <li><a href="#writing-the-function" id="toc-writing-the-function" class="nav-link" data-scroll-target="#writing-the-function"><span class="header-section-number">32.1.7</span> Writing the function</a></li>
  <li><a href="#comparing-a-new-solution-to-the-current-allocation" id="toc-comparing-a-new-solution-to-the-current-allocation" class="nav-link" data-scroll-target="#comparing-a-new-solution-to-the-current-allocation"><span class="header-section-number">32.1.8</span> Comparing a new solution to the current allocation</a></li>
  </ul></li>
  <li><a href="#trying-this-out-for-more-solutions" id="toc-trying-this-out-for-more-solutions" class="nav-link" data-scroll-target="#trying-this-out-for-more-solutions"><span class="header-section-number">32.2</span> Trying this out for more solutions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./boundary_redrawing_problems_intro.html">Part 6 - Working with Boundaries</a></li><li class="breadcrumb-item"><a href="./boundary_problems_varying_evaluating_simple.html"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Boundary Problems - Creating and Evaluating Simple Solutions</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Boundary Problems - Creating and Evaluating Simple Solutions</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="generating-and-representing-new-boundaries" class="level2" data-number="32.1">
<h2 data-number="32.1" class="anchored" data-anchor-id="generating-and-representing-new-boundaries"><span class="header-section-number">32.1</span> Generating and representing new boundaries</h2>
<p>When we come to modifying our existing boundaries, we are going to generate a large set of random new boundaries and test them.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember - in our problem statement, we specified that boundaries in our problem cannot cross through the middle of an LSOA. You would need to apply a different approach if this is not true in your case.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have a series of pre-selected solutions to try, the code in the following sections can be adapted to use those solutions rather than the randomly-generated solutions.</p>
</div>
</div>
<p>First, we will define the LSOAs that each LSOA has a continuous boundary with. These will form part of a possible series of solutions. To do this, we’ll be using the <code>.touches</code> method in geopandas.</p>
<p>In this case, a solution must meet a criteria</p>
<ul>
<li>every polygon must be assigned to a dispatcher</li>
<li>no polygon can be assigned to more than one dispatcher</li>
<li>dispatcher boundaries must be continuous; regions belonging to a dispatcher cannot be entirely separated from the rest of their dispatch area</li>
</ul>
<p>At this point, we are not trying to do anything to balance our objectives like equalising the number of calls they are going to; instead, we are simply coming up with possibilities. We’ll actually test them out in the next chapter.</p>
<section id="the-process" class="level3" data-number="32.1.1">
<h3 data-number="32.1.1" class="anchored" data-anchor-id="the-process"><span class="header-section-number">32.1.1</span> The Process</h3>
<p>To create a solution that scales well to any number of dispatchers, we will have the dispatchers start with a single randomly-selected patch from their existing location (though we will also code in an option to always start from a single specified point).</p>
<p>Then, on each ‘turn’, they will randomly choose another patch from the patches that share a boundary with the first patch. There is a small (adjustable) possibility on each turn that they will not opt to take a turn; this will be part of our strategy to ensure that not every dispatcher ends up with solutions containing exactly the same number</p>
<p>On each subsequent turn, they will randomly select another region that touches any part of their existing region. If the region that is selected is a region that they already have in their ‘patch’, then</p>
<p>Here’s an example of one of our ‘walks’ building up. This only shows the first few steps, but eventually it would continue until the whole patch was covered, following the same pattern.</p>
<p><img src="images/walk.gif" class="img-fluid"></p>
<p>This just showed us building up two patches, but more patches could be built with a larger number of ‘players’.</p>
<p><img src="images/walk_2.gif" class="img-fluid"></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember - due to the randomness we will introduce, each generated solution will be slightly different.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Again, this is not the only way we can start to generate solutions here!</p>
<p>This is one of many approaches you could take.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When we come to apply a evolutionary or genetic algorithm approach to this problem in a later chapter, we will need to change how we represent our solutions; for now, however, we can just put together lists of LSOAs that will belong to each dispatcher.</p>
</div>
</div>
<p>Let’s write and apply this function to generate a series of randomly generated solutions for our problem, which we will subsequently move on to evaluating.</p>
</section>
<section id="our-starting-dataframe" class="level3" data-number="32.1.2">
<h3 data-number="32.1.2" class="anchored" data-anchor-id="our-starting-dataframe"><span class="header-section-number">32.1.2</span> Our starting dataframe</h3>
<p>To start with, let’s load our boundary data back in. Head back to the previous chapter if any of this feels unfamiliar!</p>
<div id="40664b32" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>lsoa_geojson_path <span class="op">=</span> <span class="st">'https://github.com/hsma-programme/h6_3c_interactive_plots_travel/raw/main/h6_3c_interactive_plots_travel/example_code/LSOA_2011_Boundaries_Super_Generalised_Clipped_BSC_EW_V4.geojson'</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>lsoa_boundaries <span class="op">=</span> geopandas.read_file(lsoa_geojson_path)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> <span class="dv">370000</span>, <span class="dv">420000</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>ymin, ymax <span class="op">=</span> <span class="dv">250000</span>, <span class="dv">310000</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>bham_region <span class="op">=</span> lsoa_boundaries.cx[xmin:xmax, ymin:ymax]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>bham_region[<span class="st">"region"</span>] <span class="op">=</span> bham_region[<span class="st">"LSOA11NM"</span>].<span class="bu">str</span>[:<span class="op">-</span><span class="dv">5</span>]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>bham_region.plot(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"cyan"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/sammi/.local/lib/python3.10/site-packages/geopandas/geodataframe.py:1528: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="boundary_problems_varying_evaluating_simple_files/figure-html/cell-5-output-2.png" width="579" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="getting-the-neighbours" class="level3" data-number="32.1.3">
<h3 data-number="32.1.3" class="anchored" data-anchor-id="getting-the-neighbours"><span class="header-section-number">32.1.3</span> Getting the Neighbours</h3>
<p>Before we start worrying about the allocations, we first want to generate a column that contains a list of all of the neighbours of a given cell. This will be a lot more efficient than trying to calculate the neighbours from scratch each time we want to pick a new one - and it’s not like the neighbours will change.</p>
<p><em>GenAI Alert - This code was modified from a suggested approach provided by ChatGPT</em></p>
<div id="dbc40032" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_neighbors_column(gdf):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Adds a column to the GeoDataFrame containing lists of indices of neighboring polygons</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    based on the 'touches' method.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gdf.copy()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> []</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, geom <span class="kw">in</span> gdf.geometry.items():</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        touching <span class="op">=</span> gdf[gdf.geometry.touches(geom)][<span class="st">"LSOA11CD"</span>].tolist()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        neighbors.append(touching)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    gdf[<span class="st">"neighbors"</span>] <span class="op">=</span> neighbors</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>bham_region <span class="op">=</span> add_neighbors_column(bham_region)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>bham_region[[<span class="st">'LSOA11CD'</span>, <span class="st">'LSOA11NM'</span>, <span class="st">'LSOA11NMW'</span>, <span class="st">'geometry'</span>, <span class="st">'neighbors'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LSOA11CD</th>
<th data-quarto-table-cell-role="th">LSOA11NM</th>
<th data-quarto-table-cell-role="th">LSOA11NMW</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">neighbors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8648</td>
<td>E01008881</td>
<td>Birmingham 067A</td>
<td>Birmingham 067A</td>
<td>POLYGON ((413040.413 285809.794, 413145.440 28...</td>
<td>[E01008882, E01008883, E01008885, E01008886, E...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8649</td>
<td>E01008882</td>
<td>Birmingham 066A</td>
<td>Birmingham 066A</td>
<td>POLYGON ((412233.657 285480.231, 412255.373 28...</td>
<td>[E01008881, E01008883, E01008884, E01008898, E...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8650</td>
<td>E01008883</td>
<td>Birmingham 078A</td>
<td>Birmingham 078A</td>
<td>POLYGON ((412775.838 285204.808, 412575.845 28...</td>
<td>[E01008881, E01008882, E01008884, E01008886, E...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8651</td>
<td>E01008884</td>
<td>Birmingham 078B</td>
<td>Birmingham 078B</td>
<td>POLYGON ((411803.096 284902.674, 411563.054 28...</td>
<td>[E01008882, E01008883, E01008887, E01008889, E...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8652</td>
<td>E01008885</td>
<td>Birmingham 076A</td>
<td>Birmingham 076A</td>
<td>POLYGON ((413417.353 284803.764, 413034.282 28...</td>
<td>[E01008881, E01008886, E01008888, E01009521]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="1955eb3c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>boundary_allocations_df <span class="op">=</span> pd.read_csv(<span class="st">"boundary_allocations.csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>boundary_allocations_df.head()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>bham_region <span class="op">=</span> pd.merge(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    bham_region,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    boundary_allocations_df,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">"region"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">"Region"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>bham_region[<span class="st">"centre_dispatcher"</span>] <span class="op">=</span> bham_region[<span class="st">"Centre"</span>].astype(<span class="st">"str"</span>) <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> bham_region[<span class="st">"Dispatcher"</span>].astype(<span class="st">"str"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>bham_region</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FID</th>
<th data-quarto-table-cell-role="th">LSOA11CD</th>
<th data-quarto-table-cell-role="th">LSOA11NM</th>
<th data-quarto-table-cell-role="th">LSOA11NMW</th>
<th data-quarto-table-cell-role="th">BNG_E</th>
<th data-quarto-table-cell-role="th">BNG_N</th>
<th data-quarto-table-cell-role="th">LONG</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">neighbors</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Centre</th>
<th data-quarto-table-cell-role="th">Dispatcher</th>
<th data-quarto-table-cell-role="th">centre_dispatcher</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8649</td>
<td>E01008881</td>
<td>Birmingham 067A</td>
<td>Birmingham 067A</td>
<td>412690</td>
<td>285438</td>
<td>-1.81463</td>
<td>52.46675</td>
<td>f79cd8fb-0cf2-4c84-b07c-55bffcf379bb</td>
<td>POLYGON ((413040.413 285809.794, 413145.440 28...</td>
<td>Birmingham</td>
<td>[E01008882, E01008883, E01008885, E01008886, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8650</td>
<td>E01008882</td>
<td>Birmingham 066A</td>
<td>Birmingham 066A</td>
<td>411772</td>
<td>285390</td>
<td>-1.82814</td>
<td>52.46634</td>
<td>e7835311-f105-4c92-acae-ecd5255ce534</td>
<td>POLYGON ((412233.657 285480.231, 412255.373 28...</td>
<td>Birmingham</td>
<td>[E01008881, E01008883, E01008884, E01008898, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8651</td>
<td>E01008883</td>
<td>Birmingham 078A</td>
<td>Birmingham 078A</td>
<td>412121</td>
<td>285001</td>
<td>-1.82302</td>
<td>52.46283</td>
<td>29dbcbc2-4a29-4bb1-addb-42b37d91c647</td>
<td>POLYGON ((412775.838 285204.808, 412575.845 28...</td>
<td>Birmingham</td>
<td>[E01008881, E01008882, E01008884, E01008886, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8652</td>
<td>E01008884</td>
<td>Birmingham 078B</td>
<td>Birmingham 078B</td>
<td>411241</td>
<td>284712</td>
<td>-1.83598</td>
<td>52.46025</td>
<td>df5a2350-a102-4ecc-b028-5a0bbeded198</td>
<td>POLYGON ((411803.096 284902.674, 411563.054 28...</td>
<td>Birmingham</td>
<td>[E01008882, E01008883, E01008887, E01008889, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8653</td>
<td>E01008885</td>
<td>Birmingham 076A</td>
<td>Birmingham 076A</td>
<td>413207</td>
<td>284818</td>
<td>-1.80704</td>
<td>52.46116</td>
<td>13a855fc-fa09-42a5-a05e-947fcd141ce4</td>
<td>POLYGON ((413417.353 284803.764, 413034.282 28...</td>
<td>Birmingham</td>
<td>[E01008881, E01008886, E01008888, E01009521]</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2006</td>
<td>32722</td>
<td>E01033646</td>
<td>Birmingham 031I</td>
<td>Birmingham 031I</td>
<td>410257</td>
<td>291057</td>
<td>-1.85027</td>
<td>52.51731</td>
<td>c7a17445-f800-41bc-86fb-cbeb9cde5d3f</td>
<td>POLYGON ((410651.278 291571.301, 410562.002 29...</td>
<td>Birmingham</td>
<td>[E01009000, E01009007, E01009013, E01009401, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2007</td>
<td>32723</td>
<td>E01033647</td>
<td>Birmingham 058E</td>
<td>Birmingham 058E</td>
<td>410473</td>
<td>286828</td>
<td>-1.84722</td>
<td>52.47929</td>
<td>7d745c12-8e35-404d-b96d-f2b3c3e92896</td>
<td>POLYGON ((410665.117 286998.178, 410753.991 28...</td>
<td>Birmingham</td>
<td>[E01009194, E01009197, E01009198, E01009331, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008</td>
<td>32724</td>
<td>E01033648</td>
<td>Birmingham 084F</td>
<td>Birmingham 084F</td>
<td>408315</td>
<td>283740</td>
<td>-1.87907</td>
<td>52.45157</td>
<td>ed410ea7-fc12-42bd-8604-4a54fab04b9f</td>
<td>POLYGON ((408199.966 283979.204, 408378.884 28...</td>
<td>Birmingham</td>
<td>[E01009376, E01009377, E01009383, E01009384, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2009</td>
<td>32725</td>
<td>E01033649</td>
<td>Birmingham 058F</td>
<td>Birmingham 058F</td>
<td>410530</td>
<td>287142</td>
<td>-1.84637</td>
<td>52.48211</td>
<td>a8880f7b-a92b-43da-bf8d-b673ed85c526</td>
<td>POLYGON ((410728.297 287314.945, 410665.117 28...</td>
<td>Birmingham</td>
<td>[E01009194, E01009195, E01009197, E01033647]</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010</td>
<td>32726</td>
<td>E01033650</td>
<td>Birmingham 077F</td>
<td>Birmingham 077F</td>
<td>409357</td>
<td>284898</td>
<td>-1.86370</td>
<td>52.46196</td>
<td>2868f08d-b3bd-4e47-b985-ce8484e582f3</td>
<td>POLYGON ((409575.733 284753.232, 409442.619 28...</td>
<td>Birmingham</td>
<td>[E01009339, E01009363, E01009368, E01009371, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
</tbody>
</table>

<p>2011 rows × 16 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="making-a-dictionary-of-the-existing-allocations" class="level3" data-number="32.1.4">
<h3 data-number="32.1.4" class="anchored" data-anchor-id="making-a-dictionary-of-the-existing-allocations"><span class="header-section-number">32.1.4</span> Making a dictionary of the existing allocations</h3>
<p>First, let’s make ourselves a dictionary. In this dictionary, the keys will be the centre/dispatcher, and the values will be a list of all LSOAs that currently belong to that dispatcher.</p>
<div id="998cf8ba" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of the unique dispatchers</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dispatchers <span class="op">=</span> bham_region[<span class="st">'centre_dispatcher'</span>].unique()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>dispatchers.sort()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>dispatcher_starting_allocation_dict <span class="op">=</span> {}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dispatcher <span class="kw">in</span> dispatchers:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    dispatcher_allocation <span class="op">=</span> bham_region[bham_region[<span class="st">"centre_dispatcher"</span>] <span class="op">==</span> dispatcher]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    dispatcher_starting_allocation_dict[dispatcher] <span class="op">=</span> dispatcher_allocation[<span class="st">"LSOA11CD"</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at what that looks like for one of the dispatchers. Using this, we can access a full list of their LSOAs whenever we need it.</p>
<div id="a29a0204" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dispatcher_starting_allocation_dict[<span class="st">'Centre 2-3'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array(['E01032279', 'E01032280', 'E01032281', 'E01032282', 'E01032283',
       'E01032284', 'E01032285', 'E01032286', 'E01032287', 'E01032288',
       'E01032289', 'E01032290', 'E01032292', 'E01032294', 'E01032295',
       'E01032296', 'E01032297', 'E01032298', 'E01032299', 'E01032300',
       'E01032301', 'E01032302', 'E01032303', 'E01032304', 'E01032305',
       'E01032306', 'E01032307', 'E01032308', 'E01032309', 'E01032310',
       'E01032311', 'E01032312', 'E01032313', 'E01032314', 'E01032315',
       'E01032316', 'E01032317', 'E01032318', 'E01032319', 'E01032320',
       'E01032321', 'E01032322', 'E01032323', 'E01032324', 'E01032325',
       'E01032326', 'E01032327', 'E01032328', 'E01032329', 'E01032330',
       'E01032331', 'E01032332', 'E01032333', 'E01032334', 'E01032335',
       'E01032336', 'E01032337', 'E01032338', 'E01032339', 'E01032345',
       'E01032346', 'E01032354', 'E01032355', 'E01032357', 'E01032358',
       'E01032359', 'E01032360', 'E01032361', 'E01032362', 'E01032363',
       'E01032364', 'E01032365', 'E01032366', 'E01032367', 'E01032368',
       'E01032369', 'E01032370', 'E01032371', 'E01032386', 'E01032387',
       'E01032388', 'E01032389', 'E01032390', 'E01032392', 'E01032393',
       'E01032394', 'E01032395', 'E01032399', 'E01032400', 'E01032401',
       'E01032402', 'E01032403', 'E01032404', 'E01032410', 'E01032411',
       'E01032414', 'E01032416', 'E01032417', 'E01033246', 'E01033247',
       'E01033248', 'E01033249'], dtype=object)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To start with, let’s build up our random walk algorithm step-by-step. At the end of this section, we’ll turn it into a reusable functions with some parameters to make it easier to use. After that, we’ll work on building a reusable function to help us quickly evaluate each solution we generate.</p>
</div>
</div>
</section>
<section id="generating-starting-allocations" class="level3" data-number="32.1.5">
<h3 data-number="32.1.5" class="anchored" data-anchor-id="generating-starting-allocations"><span class="header-section-number">32.1.5</span> Generating starting allocations</h3>
<p>The first step will be to generate an initial starting point for each dispatcher.</p>
<p>There are a couple of different approaches we could take here - and maybe we’ll give our eventual algorithm the option to pick from several options.</p>
<p><em>Option 1</em></p>
<p>We could use our new dictionary to select a random starting LSOA for each of our dispatchers. This will give us plenty of randomness - but we may find ourselves with walks that start very near the edge of our original patch, giving us very different boundaries to what existed before.</p>
<div id="adefdf66" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>random_solution_starting_dict <span class="op">=</span> {}</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> dispatcher_starting_allocation_dict.items():</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    random_solution_starting_dict[key] <span class="op">=</span> random.choice(value)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>random_solution_starting_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>{'Centre 1-1': 'E01014191',
 'Centre 1-2': 'E01029503',
 'Centre 1-3': 'E01010343',
 'Centre 1-4': 'E01010520',
 'Centre 1-5': 'E01009978',
 'Centre 1-6': 'E01033564',
 'Centre 1-7': 'E01010146',
 'Centre 2-1': 'E01032174',
 'Centre 2-2': 'E01032459',
 'Centre 2-3': 'E01032295',
 'Centre 2-4': 'E01032205',
 'Centre 2-5': 'E01032266'}</code></pre>
</div>
</div>
<p>Let’s turn this into a reusable function, then visualise its functioning.</p>
<div id="0598cb73" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_random_starting_dict(input_dictionary):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    random_solution_starting_dict <span class="op">=</span> {}</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key, value <span class="kw">in</span> dispatcher_starting_allocation_dict.items():</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        random_solution_starting_dict[key] <span class="op">=</span> random.choice(value)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> random_solution_starting_dict</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>create_random_starting_dict(dispatcher_starting_allocation_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>{'Centre 1-1': 'E01028841',
 'Centre 1-2': 'E01029491',
 'Centre 1-3': 'E01010273',
 'Centre 1-4': 'E01010513',
 'Centre 1-5': 'E01010100',
 'Centre 1-6': 'E01009168',
 'Centre 1-7': 'E01010121',
 'Centre 2-1': 'E01032142',
 'Centre 2-2': 'E01032451',
 'Centre 2-3': 'E01032287',
 'Centre 2-4': 'E01014001',
 'Centre 2-5': 'E01032266'}</code></pre>
</div>
</div>
<p>Now, let’s generate some solutions and plot them.</p>
<p>We’ll also be using a dataframe from the</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the code for generating our dispatch boundaries dataframe
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="72fcece1" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by the specified column</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>grouped_dispatcher_gdf <span class="op">=</span> bham_region.groupby(<span class="st">"centre_dispatcher"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new GeoDataFrame for the boundaries of each group</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>boundary_list <span class="op">=</span> []</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group_name, group <span class="kw">in</span> grouped_dispatcher_gdf:</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine the polygons in each group into one geometry</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    combined_geometry <span class="op">=</span> group.unary_union</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the boundary of the combined geometry</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    boundary <span class="op">=</span> combined_geometry.boundary</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the boundary geometry and the group name to the list</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    boundary_list.append({<span class="st">'group'</span>: group_name, <span class="st">'boundary'</span>: boundary})</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a GeoDataFrame from the list of boundaries</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>grouped_dispatcher_gdf_boundary <span class="op">=</span> geopandas.GeoDataFrame(boundary_list, geometry<span class="op">=</span><span class="st">'boundary'</span>, crs<span class="op">=</span>bham_region.crs)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>grouped_dispatcher_gdf_boundary.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">boundary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Centre 1-1</td>
<td>MULTILINESTRING ((368935.969 274516.594, 36824...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Centre 1-2</td>
<td>LINESTRING (412258.535 300984.197, 411756.668 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Centre 1-3</td>
<td>LINESTRING (381775.908 282326.500, 380577.001 ...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Centre 1-4</td>
<td>LINESTRING (388885.341 295185.385, 388630.406 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Centre 1-5</td>
<td>LINESTRING (388258.095 285110.427, 388666.258 ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Some of the regions are quite small, so it may be hard to see them all!</p>
<div id="9312ee7d" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, let's plot the outline of our entire region</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> bham_region.plot(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's use our new function to generate a series of random starting patches</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>sol <span class="op">=</span> create_random_starting_dict(dispatcher_starting_allocation_dict)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># We can filter our existing dataframe of allocations to just the starting patches</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>random_solution_start <span class="op">=</span> bham_region[bham_region[<span class="st">'LSOA11CD'</span>].isin(sol.values())]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, we plot those on the same plot, colouring by centre-dispatcher combo</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>random_solution_start.plot(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"centre_dispatcher"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's also visualise the historical boundaries</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>grouped_dispatcher_gdf_boundary.plot(</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"green"</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="boundary_problems_varying_evaluating_simple_files/figure-html/cell-13-output-1.png" width="579" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Option 2</em></p>
<p>Another alternative is to start with the most central region of the existing regions for each dispatcher.</p>
<div id="10421fa9" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_most_central_polygon(gdf):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Finds the most central polygon in a GeoDataFrame based on centroid proximity to the mean centroid.</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute centroids of individual polygons</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    gdf[<span class="st">"centroid"</span>] <span class="op">=</span> gdf.geometry.centroid</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the mean centroid (central point)</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    mean_centroid <span class="op">=</span> gdf.geometry.unary_union.centroid</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute distances from each centroid to the mean centroid</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    gdf[<span class="st">"distance_to_mean"</span>] <span class="op">=</span> gdf[<span class="st">"centroid"</span>].distance(mean_centroid)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the polygon with the minimum distance</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    central_polygon <span class="op">=</span> gdf.loc[gdf[<span class="st">"distance_to_mean"</span>].idxmin()]</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> central_polygon</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_central_polygon_per_group(gdf, grouping_col):</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf.groupby(grouping_col, group_keys<span class="op">=</span><span class="va">False</span>).<span class="bu">apply</span>(find_most_central_polygon).drop(columns<span class="op">=</span>[<span class="st">"centroid"</span>, <span class="st">"distance_to_mean"</span>])</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>most_central <span class="op">=</span> get_central_polygon_per_group(bham_region, <span class="st">"centre_dispatcher"</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>most_central</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FID</th>
<th data-quarto-table-cell-role="th">LSOA11CD</th>
<th data-quarto-table-cell-role="th">LSOA11NM</th>
<th data-quarto-table-cell-role="th">LSOA11NMW</th>
<th data-quarto-table-cell-role="th">BNG_E</th>
<th data-quarto-table-cell-role="th">BNG_N</th>
<th data-quarto-table-cell-role="th">LONG</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">neighbors</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Centre</th>
<th data-quarto-table-cell-role="th">Dispatcher</th>
<th data-quarto-table-cell-role="th">centre_dispatcher</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">centre_dispatcher</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centre 1-1</td>
<td>28095</td>
<td>E01028832</td>
<td>Shropshire 033A</td>
<td>Shropshire 033A</td>
<td>372082</td>
<td>293080</td>
<td>-2.41300</td>
<td>52.53487</td>
<td>945b5cd8-45bd-4f3a-8834-88082caa2473</td>
<td>POLYGON ((372799.246 293568.354, 372202.351 29...</td>
<td>Shropshire</td>
<td>[E01028828, E01028830, E01028833, E01028834, E...</td>
<td>Shropshire</td>
<td>Centre 1</td>
<td>1</td>
<td>Centre 1-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centre 1-2</td>
<td>28764</td>
<td>E01029518</td>
<td>Lichfield 007D</td>
<td>Lichfield 007D</td>
<td>411232</td>
<td>307750</td>
<td>-1.83534</td>
<td>52.66736</td>
<td>421455c3-c4b7-4505-880d-8412aa14c957</td>
<td>POLYGON ((412402.657 308666.999, 412311.329 30...</td>
<td>Lichfield</td>
<td>[E01029488, E01029512, E01029519, E01029520, E...</td>
<td>Lichfield</td>
<td>Centre 1</td>
<td>2</td>
<td>Centre 1-2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centre 1-3</td>
<td>28875</td>
<td>E01029631</td>
<td>South Staffordshire 009E</td>
<td>South Staffordshire 009E</td>
<td>388142</td>
<td>301842</td>
<td>-2.17656</td>
<td>52.61423</td>
<td>6d0e4c4c-bf69-4f68-a086-46d1a80854d9</td>
<td>POLYGON ((387776.111 302749.666, 388831.796 30...</td>
<td>South Staffordshire</td>
<td>[E01010544, E01010546, E01029613, E01029615, E...</td>
<td>South Staffordshire</td>
<td>Centre 1</td>
<td>3</td>
<td>Centre 1-3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centre 1-4</td>
<td>10215</td>
<td>E01010521</td>
<td>Wolverhampton 020F</td>
<td>Wolverhampton 020F</td>
<td>391688</td>
<td>299252</td>
<td>-2.12412</td>
<td>52.59101</td>
<td>5966f7f1-af15-4226-9d1e-6316101606b5</td>
<td>POLYGON ((391805.204 300349.956, 392207.285 29...</td>
<td>Wolverhampton</td>
<td>[E01010426, E01010443, E01010463, E01010464, E...</td>
<td>Wolverhampton</td>
<td>Centre 1</td>
<td>4</td>
<td>Centre 1-4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centre 1-5</td>
<td>9743</td>
<td>E01010043</td>
<td>Sandwell 025B</td>
<td>Sandwell 025B</td>
<td>395995</td>
<td>288750</td>
<td>-2.06041</td>
<td>52.49665</td>
<td>3be670e2-fde7-4251-ad24-56335b4c30df</td>
<td>POLYGON ((396648.514 288801.684, 396670.147 28...</td>
<td>Sandwell</td>
<td>[E01009843, E01009871, E01009888, E01009890, E...</td>
<td>Sandwell</td>
<td>Centre 1</td>
<td>5</td>
<td>Centre 1-5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centre 1-6</td>
<td>8940</td>
<td>E01009204</td>
<td>Birmingham 052E</td>
<td>Birmingham 052E</td>
<td>408607</td>
<td>287498</td>
<td>-1.87467</td>
<td>52.48535</td>
<td>e1aaf4f1-f7a4-4e98-9d74-855033a27584</td>
<td>POLYGON ((409131.178 287204.736, 408353.160 28...</td>
<td>Birmingham</td>
<td>[E01009199, E01009201, E01009203, E01033561, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centre 1-7</td>
<td>9809</td>
<td>E01010109</td>
<td>Solihull 009A</td>
<td>Solihull 009A</td>
<td>418665</td>
<td>283710</td>
<td>-1.72677</td>
<td>52.45104</td>
<td>d03080c8-368a-46af-9fed-b27cc051518e</td>
<td>POLYGON ((419807.904 285425.582, 419899.498 28...</td>
<td>Solihull</td>
<td>[E01009318, E01009320, E01010108, E01010110, E...</td>
<td>Solihull</td>
<td>Centre 1</td>
<td>7</td>
<td>Centre 1-7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centre 2-1</td>
<td>31345</td>
<td>E01032149</td>
<td>Bromsgrove 006D</td>
<td>Bromsgrove 006D</td>
<td>399455</td>
<td>274007</td>
<td>-2.00941</td>
<td>52.36413</td>
<td>3b13e41d-e470-47c0-9830-cd654e36a32e</td>
<td>POLYGON ((399816.607 273656.656, 400092.197 27...</td>
<td>Bromsgrove</td>
<td>[E01032143, E01032144, E01032148, E01032150, E...</td>
<td>Bromsgrove</td>
<td>Centre 2</td>
<td>1</td>
<td>Centre 2-1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centre 2-2</td>
<td>31667</td>
<td>E01032477</td>
<td>Wyre Forest 008D</td>
<td>Wyre Forest 008D</td>
<td>381330</td>
<td>275610</td>
<td>-2.27568</td>
<td>52.37821</td>
<td>4f0cf516-7c4b-4b61-a4da-da4423304f43</td>
<td>POLYGON ((381780.507 275809.361, 381793.089 27...</td>
<td>Wyre Forest</td>
<td>[E01032451, E01032470, E01032471, E01032476, E...</td>
<td>Wyre Forest</td>
<td>Centre 2</td>
<td>2</td>
<td>Centre 2-2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centre 2-3</td>
<td>31535</td>
<td>E01032345</td>
<td>Wychavon 007A</td>
<td>Wychavon 007A</td>
<td>393387</td>
<td>259105</td>
<td>-2.09823</td>
<td>52.23011</td>
<td>b7f03ca0-aac0-4e29-b86c-95dd4a796fce</td>
<td>POLYGON ((396864.091 258452.893, 396188.712 25...</td>
<td>Wychavon</td>
<td>[E01032346, E01032360, E01032361, E01032362, E...</td>
<td>Wychavon</td>
<td>Centre 2</td>
<td>3</td>
<td>Centre 2-3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Centre 2-4</td>
<td>31391</td>
<td>E01032199</td>
<td>Malvern Hills 002C</td>
<td>Malvern Hills 002C</td>
<td>376434</td>
<td>260160</td>
<td>-2.34652</td>
<td>52.23913</td>
<td>c4525de8-e8d8-4d8b-9610-d887d58dbabb</td>
<td>POLYGON ((378353.003 262294.903, 378414.904 26...</td>
<td>Malvern Hills</td>
<td>[E01014001, E01032179, E01032181, E01032182, E...</td>
<td>Malvern Hills</td>
<td>Centre 2</td>
<td>4</td>
<td>Centre 2-4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Centre 2-5</td>
<td>30398</td>
<td>E01031187</td>
<td>Stratford-on-Avon 007A</td>
<td>Stratford-on-Avon 007A</td>
<td>414464</td>
<td>258742</td>
<td>-1.78965</td>
<td>52.22670</td>
<td>679c1798-8095-4712-a9b9-c495cca9dadd</td>
<td>POLYGON ((416799.690 260453.800, 416633.500 25...</td>
<td>Stratford-on-Avon</td>
<td>[E01031188, E01031195, E01031204, E01031208, E...</td>
<td>Stratford-on-Avon</td>
<td>Centre 2</td>
<td>5</td>
<td>Centre 2-5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Let’s plot this.</p>
<div id="f782b253" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, let's plot the outline of our entire region</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> bham_region.plot(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot those on the same plot, colouring by centre-dispatcher combo</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>most_central.plot(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"centre_dispatcher"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's also visualise the historical boundaries</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>grouped_dispatcher_gdf_boundary.plot(</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"green"</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="boundary_problems_varying_evaluating_simple_files/figure-html/cell-15-output-1.png" width="579" height="559" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>You can see that in some regions the most central point can still be on a boundary, even</p>
</section>
<section id="generating-our-new-regions" class="level3" data-number="32.1.6">
<h3 data-number="32.1.6" class="anchored" data-anchor-id="generating-our-new-regions"><span class="header-section-number">32.1.6</span> Generating our new regions</h3>
<p>As a recap, what we want to do now is introduce a number of ‘players’ who will play a territory-grabbing game. Our ‘players’ - the dispatchers - will each have a single turn, pass control to the next dispatcher, and so on.</p>
<p>On each turn, they will be presented with a long list of the regions that share a boundary with any of their existing territories. They will then choose a territory at random from that list.</p>
<p>However, this doesn’t mean their territory will expand on every turn.</p>
<ul>
<li>The territory that they choose could be one of their existing territories (as we are checking for a boundary with <em>any</em> of their existing territories on a per-territory basis - not the outer boundary of their entire territory)</li>
<li>There will also be a random chance introduced that they just don’t take a go</li>
<li>They may also try to take a territory that is already owned by a different dispatcher, in which case they will not gain anything on the turn - though we could always add in an option like them ‘battling’ for the territory</li>
</ul>
<p>So let’s start coding this!</p>
<p>First, let’s work on the logic for selecting a territory from their existing list. We’ll just do this with a single dispatcher for now.</p>
<p>We’ll filter down to this and remind ourselves what the available data on neighbouring territory looks like.</p>
<div id="98009c31" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll start with dispatcher 5 from centre 2, and we'll use the most central point of their existing territory</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>dispatcher <span class="op">=</span> <span class="st">"Centre 2-5"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>starting_point <span class="op">=</span> most_central[most_central[<span class="st">"centre_dispatcher"</span>] <span class="op">==</span> dispatcher]</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>starting_point[<span class="st">'neighbors'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>centre_dispatcher
Centre 2-5    [E01031188, E01031195, E01031204, E01031208, E...
Name: neighbors, dtype: object</code></pre>
</div>
</div>
<p>Let’s now pick a random neighbour, and work out a way to store the new allocations so we can ensure we know who owns what territory, and we don’t end up with a situation where two dispatchers own the same territory.</p>
<div id="f528c2e8" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>owned_territory_dict <span class="op">=</span> {}</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>owned_territory_dict[dispatcher] <span class="op">=</span> [starting_point[<span class="st">'LSOA11CD'</span>].values[<span class="dv">0</span>]]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>owned_territory_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>{'Centre 2-5': ['E01031187']}</code></pre>
</div>
</div>
<div id="115f4ae5" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>selected_territory <span class="op">=</span> random.choice(starting_point[<span class="st">'neighbors'</span>].values[<span class="dv">0</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>selected_territory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>'E01031208'</code></pre>
</div>
</div>
<div id="6d4f3fa2" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>owned_territory_dict[dispatcher].append(selected_territory)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>owned_territory_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>{'Centre 2-5': ['E01031187', 'E01031208']}</code></pre>
</div>
</div>
<p>Fantastic! We now have a simple way to get and store this.</p>
<p>Let’s have a go at giving another dispatcher a turn to grab territory.</p>
<div id="888e9f32" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dispatcher <span class="op">=</span> <span class="st">"Centre 1-1"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>starting_point <span class="op">=</span> most_central[most_central[<span class="st">"centre_dispatcher"</span>] <span class="op">==</span> dispatcher]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This time we add to the existing dict rather than setting it up anew</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>owned_territory_dict[dispatcher] <span class="op">=</span> [starting_point[<span class="st">'LSOA11CD'</span>].values[<span class="dv">0</span>]]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we do our random selection</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>selected_territory <span class="op">=</span> random.choice(starting_point[<span class="st">'neighbors'</span>].values[<span class="dv">0</span>])</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>owned_territory_dict[dispatcher].append(selected_territory)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>owned_territory_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>{'Centre 2-5': ['E01031187', 'E01031208'],
 'Centre 1-1': ['E01028832', 'E01028859']}</code></pre>
</div>
</div>
<p>This is a good step, and for now we’re unlikely to run into the issue of different dispatchers owning the same territory - though it’s not impossible! So let’s add in another dispatcher, but this time we’ll check first that it’s not owned by anyone.</p>
<p>First, let’s pull back the full list of owned territories from our dict.</p>
<div id="5ec8f556" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(owned_territory_dict.values())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>[['E01031187', 'E01031208'], ['E01028832', 'E01028859']]</code></pre>
</div>
</div>
<p>We’ll need to convert this into a single list. We could use a for loop, or a list comprehension.</p>
<div id="175b0adb" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>territory_list <span class="op">=</span> [element <span class="cf">for</span> sub_list <span class="kw">in</span> <span class="bu">list</span>(owned_territory_dict.values()) <span class="cf">for</span> element <span class="kw">in</span> sub_list]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># By using set, then list on the result of that, we get a list of unique values</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>territory_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(territory_list))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>territory_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>['E01031208', 'E01031187', 'E01028832', 'E01028859']</code></pre>
</div>
</div>
<p>Now we can use this in our checks.</p>
<div id="0c99ab18" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dispatcher <span class="op">=</span> <span class="st">"Centre 1-5"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>starting_point <span class="op">=</span> most_central[most_central[<span class="st">"centre_dispatcher"</span>] <span class="op">==</span> dispatcher]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>owned_territory_dict[dispatcher] <span class="op">=</span> [starting_point[<span class="st">'LSOA11CD'</span>].values[<span class="dv">0</span>]]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>selected_territory <span class="op">=</span> random.choice(starting_point[<span class="st">'neighbors'</span>].values[<span class="dv">0</span>])</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Only add the territory if it's not already in the list of owned territory</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> selected_territory <span class="kw">not</span> <span class="kw">in</span> territory_list:</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    owned_territory_dict[dispatcher].append(selected_territory)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>owned_territory_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>{'Centre 2-5': ['E01031187', 'E01031208'],
 'Centre 1-1': ['E01028832', 'E01028859'],
 'Centre 1-5': ['E01010043', 'E01009890']}</code></pre>
</div>
</div>
</section>
<section id="writing-the-function" class="level3" data-number="32.1.7">
<h3 data-number="32.1.7" class="anchored" data-anchor-id="writing-the-function"><span class="header-section-number">32.1.7</span> Writing the function</h3>
<p>That’s most of the key elements of our function written now - so let’s actually turn it into a function that will continue to run until all of the territory has been allocated.</p>
<p>For clarity and ease of use, we’ll set up our defaults to relate to our current objects - but for a more reusable function, it may be better to avoid defaults but be very clear in the docstring what is expected as an input, and add in some error handling to manage cases that don’t match.</p>
<div id="5f86ce87" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_random_territory_allocation(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    gdf<span class="op">=</span>bham_region,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    territory_unit_column<span class="op">=</span><span class="st">"LSOA11CD"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    player_list<span class="op">=</span>bham_region[<span class="st">"centre_dispatcher"</span>].unique(),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    player_column<span class="op">=</span><span class="st">"centre_dispatcher"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    starting_territories<span class="op">=</span>most_central,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    neighbor_column<span class="op">=</span><span class="st">'neighbors'</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    skipgo_chance<span class="op">=</span><span class="fl">0.03</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    return_df<span class="op">=</span><span class="va">True</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialise the territory list as the starting territories</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    owned_territory_list <span class="op">=</span> <span class="bu">list</span>(starting_territories[territory_unit_column].unique())</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up the starting territory for each individual and have each player have their first go</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> player <span class="kw">in</span> player_list:</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        starting_point <span class="op">=</span> starting_territories[starting_territories[player_column] <span class="op">==</span> player]</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        owned_territory_dict[player] <span class="op">=</span> [starting_point[territory_unit_column].values[<span class="dv">0</span>]]</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>        selected_territory <span class="op">=</span> random.choice(starting_point[<span class="st">'neighbors'</span>].values[<span class="dv">0</span>])</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only add the territory if it's not already in the list of owned territory</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> selected_territory <span class="kw">not</span> <span class="kw">in</span> owned_territory_list:</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>            owned_territory_dict[player].append(selected_territory)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># As we're now going to be iterating and checking throughout, we can just</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># maintain the owned territory list as we go along, which is a bit easier and</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># more efficient than generating it from the territory dict each time</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            owned_territory_list.append(selected_territory)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep going through the following process until all territory has been allocated</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="bu">len</span>(owned_territory_list) <span class="op">&lt;</span> <span class="bu">len</span>(gdf[territory_unit_column].unique()):</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Go around all individuals</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> player <span class="kw">in</span> player_list:</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Select a random existing territory from the list of owned territories</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>            chosen_owned_territory <span class="op">=</span> random.choice(owned_territory_dict[player])</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Then find the neighbours</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>            neighbors <span class="op">=</span> gdf[gdf[territory_unit_column] <span class="op">==</span> chosen_owned_territory][neighbor_column].values[<span class="dv">0</span>]</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Choose a random neighbour and update the list of owned territories...</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>            selected_territory <span class="op">=</span> random.choice(neighbors)</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>            <span class="co">#... if not already owned</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> selected_territory <span class="kw">not</span> <span class="kw">in</span> owned_territory_list:</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>                owned_territory_dict[player].append(selected_territory)</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>                owned_territory_list.append(selected_territory)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> return_df:</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>        owned_territory_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>            [(key, value) <span class="cf">for</span> key, values <span class="kw">in</span> owned_territory_dict.items() <span class="cf">for</span> value <span class="kw">in</span> values],</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>[<span class="ss">f"</span><span class="sc">{</span>player_column<span class="sc">}</span><span class="ss">_NEW"</span>, territory_unit_column])</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.merge(gdf, owned_territory_df, on<span class="op">=</span>territory_unit_column, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> owned_territory_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try our new function out and see what it returns.</p>
<div id="caad4ac3" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>random_allocation_test <span class="op">=</span> generate_random_territory_allocation()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>random_allocation_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">FID</th>
<th data-quarto-table-cell-role="th">LSOA11CD</th>
<th data-quarto-table-cell-role="th">LSOA11NM</th>
<th data-quarto-table-cell-role="th">LSOA11NMW</th>
<th data-quarto-table-cell-role="th">BNG_E</th>
<th data-quarto-table-cell-role="th">BNG_N</th>
<th data-quarto-table-cell-role="th">LONG</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">region</th>
<th data-quarto-table-cell-role="th">neighbors</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Centre</th>
<th data-quarto-table-cell-role="th">Dispatcher</th>
<th data-quarto-table-cell-role="th">centre_dispatcher</th>
<th data-quarto-table-cell-role="th">centre_dispatcher_NEW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8649</td>
<td>E01008881</td>
<td>Birmingham 067A</td>
<td>Birmingham 067A</td>
<td>412690</td>
<td>285438</td>
<td>-1.81463</td>
<td>52.46675</td>
<td>f79cd8fb-0cf2-4c84-b07c-55bffcf379bb</td>
<td>POLYGON ((413040.413 285809.794, 413145.440 28...</td>
<td>Birmingham</td>
<td>[E01008882, E01008883, E01008885, E01008886, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8650</td>
<td>E01008882</td>
<td>Birmingham 066A</td>
<td>Birmingham 066A</td>
<td>411772</td>
<td>285390</td>
<td>-1.82814</td>
<td>52.46634</td>
<td>e7835311-f105-4c92-acae-ecd5255ce534</td>
<td>POLYGON ((412233.657 285480.231, 412255.373 28...</td>
<td>Birmingham</td>
<td>[E01008881, E01008883, E01008884, E01008898, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8651</td>
<td>E01008883</td>
<td>Birmingham 078A</td>
<td>Birmingham 078A</td>
<td>412121</td>
<td>285001</td>
<td>-1.82302</td>
<td>52.46283</td>
<td>29dbcbc2-4a29-4bb1-addb-42b37d91c647</td>
<td>POLYGON ((412775.838 285204.808, 412575.845 28...</td>
<td>Birmingham</td>
<td>[E01008881, E01008882, E01008884, E01008886, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>8652</td>
<td>E01008884</td>
<td>Birmingham 078B</td>
<td>Birmingham 078B</td>
<td>411241</td>
<td>284712</td>
<td>-1.83598</td>
<td>52.46025</td>
<td>df5a2350-a102-4ecc-b028-5a0bbeded198</td>
<td>POLYGON ((411803.096 284902.674, 411563.054 28...</td>
<td>Birmingham</td>
<td>[E01008882, E01008883, E01008887, E01008889, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8653</td>
<td>E01008885</td>
<td>Birmingham 076A</td>
<td>Birmingham 076A</td>
<td>413207</td>
<td>284818</td>
<td>-1.80704</td>
<td>52.46116</td>
<td>13a855fc-fa09-42a5-a05e-947fcd141ce4</td>
<td>POLYGON ((413417.353 284803.764, 413034.282 28...</td>
<td>Birmingham</td>
<td>[E01008881, E01008886, E01008888, E01009521]</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2006</td>
<td>32722</td>
<td>E01033646</td>
<td>Birmingham 031I</td>
<td>Birmingham 031I</td>
<td>410257</td>
<td>291057</td>
<td>-1.85027</td>
<td>52.51731</td>
<td>c7a17445-f800-41bc-86fb-cbeb9cde5d3f</td>
<td>POLYGON ((410651.278 291571.301, 410562.002 29...</td>
<td>Birmingham</td>
<td>[E01009000, E01009007, E01009013, E01009401, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2007</td>
<td>32723</td>
<td>E01033647</td>
<td>Birmingham 058E</td>
<td>Birmingham 058E</td>
<td>410473</td>
<td>286828</td>
<td>-1.84722</td>
<td>52.47929</td>
<td>7d745c12-8e35-404d-b96d-f2b3c3e92896</td>
<td>POLYGON ((410665.117 286998.178, 410753.991 28...</td>
<td>Birmingham</td>
<td>[E01009194, E01009197, E01009198, E01009331, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008</td>
<td>32724</td>
<td>E01033648</td>
<td>Birmingham 084F</td>
<td>Birmingham 084F</td>
<td>408315</td>
<td>283740</td>
<td>-1.87907</td>
<td>52.45157</td>
<td>ed410ea7-fc12-42bd-8604-4a54fab04b9f</td>
<td>POLYGON ((408199.966 283979.204, 408378.884 28...</td>
<td>Birmingham</td>
<td>[E01009376, E01009377, E01009383, E01009384, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2009</td>
<td>32725</td>
<td>E01033649</td>
<td>Birmingham 058F</td>
<td>Birmingham 058F</td>
<td>410530</td>
<td>287142</td>
<td>-1.84637</td>
<td>52.48211</td>
<td>a8880f7b-a92b-43da-bf8d-b673ed85c526</td>
<td>POLYGON ((410728.297 287314.945, 410665.117 28...</td>
<td>Birmingham</td>
<td>[E01009194, E01009195, E01009197, E01033647]</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2010</td>
<td>32726</td>
<td>E01033650</td>
<td>Birmingham 077F</td>
<td>Birmingham 077F</td>
<td>409357</td>
<td>284898</td>
<td>-1.86370</td>
<td>52.46196</td>
<td>2868f08d-b3bd-4e47-b985-ce8484e582f3</td>
<td>POLYGON ((409575.733 284753.232, 409442.619 28...</td>
<td>Birmingham</td>
<td>[E01009339, E01009363, E01009368, E01009371, E...</td>
<td>Birmingham</td>
<td>Centre 1</td>
<td>6</td>
<td>Centre 1-6</td>
<td>Centre 1-6</td>
</tr>
</tbody>
</table>

<p>2011 rows × 17 columns</p>
</div>
</div>
</div>
</div>
<p>Let’s see how much this differs from the original allocation.</p>
<div id="8606595b" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the new boundaries using colours</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> random_allocation_test.plot(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"centre_dispatcher_NEW"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise the historical boundaries</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>grouped_dispatcher_gdf_boundary.plot(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"green"</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="boundary_problems_varying_evaluating_simple_files/figure-html/cell-26-output-1.png" width="444" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparing-a-new-solution-to-the-current-allocation" class="level3" data-number="32.1.8">
<h3 data-number="32.1.8" class="anchored" data-anchor-id="comparing-a-new-solution-to-the-current-allocation"><span class="header-section-number">32.1.8</span> Comparing a new solution to the current allocation</h3>
<p>For now, we’re going to judge a solution on a single criteria - the average absolute difference in demand across</p>
<p>This is calculated by calculating the difference in total demand experiences by one dispatcher from the average across all dispatchers. We then take the absolute value - i.e.&nbsp;if the difference is negative (the dispatcher received fewer calls than the average), we will turn it into a postive. Finally, we take the average across these values.</p>
<p>We’ll create a function to do this.</p>
<div id="4eec9c73" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_solution(gdf, allocation_column<span class="op">=</span><span class="st">'centre_dispatcher_NEW'</span>, demand_column<span class="op">=</span><span class="st">"demand"</span>):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    grouped_by_dispatcher <span class="op">=</span> gdf.groupby(allocation_column)[[demand_column]].<span class="bu">sum</span>()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    mean_demand <span class="op">=</span> grouped_by_dispatcher[<span class="st">'demand'</span>].mean()</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    grouped_by_dispatcher[<span class="st">'difference_from_mean'</span>] <span class="op">=</span> (grouped_by_dispatcher[<span class="st">'demand'</span>] <span class="op">-</span> mean_demand).astype(<span class="st">'int'</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(grouped_by_dispatcher[<span class="st">'difference_from_mean'</span>]).mean().<span class="bu">round</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now let’s try this out on our original and new solutions</p>
<div id="23839a5c" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>demand <span class="op">=</span> pd.read_csv(<span class="st">"demand_pop_bham.csv"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>random_allocation_test <span class="op">=</span> random_allocation_test.merge(demand, on<span class="op">=</span><span class="st">"LSOA11CD"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>original_result <span class="op">=</span> evaluate_solution(random_allocation_test, allocation_column<span class="op">=</span><span class="st">'centre_dispatcher'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>new_result <span class="op">=</span> evaluate_solution(random_allocation_test, allocation_column<span class="op">=</span><span class="st">'centre_dispatcher_NEW'</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original Allocation: </span><span class="sc">{</span>original_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Random Solution 1: </span><span class="sc">{</span>new_result<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> original_result <span class="op">&gt;</span> new_result:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"The randomly generated solution gives a more even allocation of events than the original dispatcher allocations"</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"The randomly generated solution is worse than the original dispatcher allocations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original Allocation: 20934.4
Random Solution 1: 11374.4
The randomly generated solution gives a more even allocation of events than the original dispatcher allocations</code></pre>
</div>
</div>
</section>
</section>
<section id="trying-this-out-for-more-solutions" class="level2" data-number="32.2">
<h2 data-number="32.2" class="anchored" data-anchor-id="trying-this-out-for-more-solutions"><span class="header-section-number">32.2</span> Trying this out for more solutions</h2>
<p>Let’s now run this for 20 different solutions and store the results.</p>
<div id="e05c6c51" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_solution_dict(solution_dict, gdf, allocation_column<span class="op">=</span><span class="st">'centre_dispatcher'</span>, demand_column<span class="op">=</span><span class="st">"demand"</span>, territory_unit_column<span class="op">=</span><span class="st">"LSOA11CD"</span>):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    owned_territory_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>            [(key, value) <span class="cf">for</span> key, values <span class="kw">in</span> solution_dict.items() <span class="cf">for</span> value <span class="kw">in</span> values],</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>[<span class="ss">f"</span><span class="sc">{</span>allocation_column<span class="sc">}</span><span class="ss">_NEW"</span>, territory_unit_column])</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> pd.merge(gdf, owned_territory_df, on<span class="op">=</span>territory_unit_column, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    grouped_by_dispatcher <span class="op">=</span> gdf.groupby(<span class="ss">f"</span><span class="sc">{</span>allocation_column<span class="sc">}</span><span class="ss">_NEW"</span>)[[demand_column]].<span class="bu">sum</span>()</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    mean_demand <span class="op">=</span> grouped_by_dispatcher[<span class="st">'demand'</span>].mean()</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    grouped_by_dispatcher[<span class="st">'difference_from_mean'</span>] <span class="op">=</span> (grouped_by_dispatcher[<span class="st">'demand'</span>] <span class="op">-</span> mean_demand).astype(<span class="st">'int'</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(grouped_by_dispatcher[<span class="st">'difference_from_mean'</span>]).mean().<span class="bu">round</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ff66eba8" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure our dataframe has the demand column</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>bham_region <span class="op">=</span> bham_region.merge(demand, on<span class="op">=</span><span class="st">"LSOA11CD"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>solutions <span class="op">=</span> []</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>):</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    allocations <span class="op">=</span> generate_random_territory_allocation(return_df<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    allocation_evaluation <span class="op">=</span> evaluate_solution_dict(solution_dict<span class="op">=</span>allocations, gdf<span class="op">=</span>bham_region)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    solutions.append({</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'solution'</span>: i<span class="op">+</span><span class="dv">1</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'allocations'</span>: allocations,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'result'</span>: allocation_evaluation</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>solution_df <span class="op">=</span> pd.DataFrame(solutions)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>solution_df[<span class="st">'rank'</span>] <span class="op">=</span> solution_df[<span class="st">'result'</span>].rank(method<span class="op">=</span><span class="st">'max'</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>solution_df.to_pickle(<span class="st">'solutions_example.pkl'</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>solution_df.sort_values(<span class="st">'rank'</span>, ascending<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">solution</th>
<th data-quarto-table-cell-role="th">allocations</th>
<th data-quarto-table-cell-role="th">result</th>
<th data-quarto-table-cell-role="th">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>9278.5</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>11</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>10678.9</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>10935.3</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>11040.1</td>
<td>4.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>11321.8</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>13</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>11334.8</td>
<td>6.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>11391.7</td>
<td>7.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>11708.2</td>
<td>8.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>12512.2</td>
<td>9.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>16</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>12513.8</td>
<td>10.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>15</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>12863.8</td>
<td>11.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>14</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>12917.0</td>
<td>12.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>19</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13009.1</td>
<td>13.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>20</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13138.1</td>
<td>14.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>17</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13341.1</td>
<td>15.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13411.6</td>
<td>16.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>12</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13661.0</td>
<td>17.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13799.6</td>
<td>18.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>13891.6</td>
<td>19.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>18</td>
<td>{'Centre 2-5': ['E01031187', 'E01031188', 'E01...</td>
<td>14538.4</td>
<td>20.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");
  console.log(document.getElementsByClassName("webex-check"));

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";

    check_answer_box_nodelist = this.parentNode.childNodes
    console.log(check_answer_box_nodelist)
    for (let i = 0; i < check_answer_box_nodelist.length; i++) {
      var cl_inner = check_answer_box_nodelist[i].classList;
      console.log("Nodelist", i, ":", cl_inner);
      if (typeof cl_inner !== "undefined")
        {
          if (cl_inner.contains("feedback")) {
            {/* console.log(cl_inner.contains("feedback")) */}
            {/* console.log(check_answer_box_nodelist[i].style.display) */}
            check_answer_box_nodelist[i].style.display = "block"
          }
        }

      }

  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";

    check_answer_box_nodelist = this.parentNode.childNodes
    console.log(check_answer_box_nodelist)
    for (let i = 0; i < check_answer_box_nodelist.length; i++) {
      var cl_inner = check_answer_box_nodelist[i].classList;
      console.log("Nodelist", i, ":", cl_inner);
      if (typeof cl_inner !== "undefined")
        {
          if (cl_inner.contains("feedback")) {
            {/* console.log(cl_inner.contains("feedback")) */}
            {/* console.log(check_answer_box_nodelist[i].style.display) */}
            check_answer_box_nodelist[i].style.display = "none"
          }
        }

      }

  }

}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");
  {/* console.log(e) */}
  {/* console.log(this) */}

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;

  var feedback = (this.getAttribute("feedback"))

  if (document.getElementById('feedbackDiv'+this.id) === null){

    var feedbackDiv = document.createElement("p");
    feedbackDiv.setAttribute("id", "feedbackDiv"+this.id);
    feedbackDiv.setAttribute("class", "feedback");

  } else {

    var feedbackDiv = document.getElementById('feedbackDiv'+this.id)
    feedbackDiv.innerHTML = "";

  }

  // Check if inside a 'check answers' box - if so and if answer box is
  // currently unchecked, ensure feedback is hidden
  if (this.parentElement.parentElement.classList.contains("unchecked")) {
    {/* console.log(this.parentElement.parentElement.classList); */}
    feedbackDiv.style.display = "none"
  } else {
    {/* console.log(this.parentElement.parentElement.classList); */}
    feedbackDiv.style.display = "block"
  }

  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
    feedbackDiv.innerHTML = feedback;
  	this.parentNode.insertAdjacentElement('afterend', feedbackDiv);
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
      feedbackDiv.innerHTML = feedback;
  	  this.parentNode.insertAdjacentElement('afterend', feedbackDiv);
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList
  var feedback = (this[this.selectedIndex].getAttribute("feedback"))

  if (document.getElementById('feedbackDiv'+this.id) === null){

    var feedbackDiv = document.createElement("p");
    feedbackDiv.setAttribute("id", "feedbackDiv"+this.id);
    feedbackDiv.setAttribute("class", "feedback");

  } else {

    var feedbackDiv = document.getElementById('feedbackDiv'+this.id)
    feedbackDiv.innerHTML = "";

  }

  feedbackDiv.innerHTML = feedback;
  this.parentNode.insertAdjacentElement('afterend', feedbackDiv);

  // Check if inside a 'check answers' box - if so and if answer box is
  // currently unchecked, ensure feedback is hidden
  if (this.parentElement.parentElement.classList.contains("unchecked")) {
    {/* console.log(this.parentElement.parentElement.classList); */}
    feedbackDiv.style.display = "none"
  } else {
    {/* console.log(this.parentElement.parentElement.classList); */}
    feedbackDiv.style.display = "block"
  }

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;
  var feedback = (checked_button.getAttribute("feedback"))
  if (feedback !== null & feedback !== "<b></b>") { feedback = feedback + "</br></br>" }

  if (document.getElementById('feedbackDiv'+this.id) === null){

    var feedbackDiv = document.createElement("div");
    feedbackDiv.setAttribute("id", "feedbackDiv"+this.id);
    feedbackDiv.setAttribute("class", "feedback");

  } else {

      var feedbackDiv = document.getElementById('feedbackDiv'+this.id)
      feedbackDiv.innerHTML = "";

  }

  const currentDiv = document.getElementById(this);
  feedbackDiv.innerHTML = feedback;
  this.insertAdjacentElement('afterend', feedbackDiv);

    // Check if inside a 'check answers' box - if so and if answer box is
  // currently unchecked, ensure feedback is hidden
  if (this.parentElement.classList.contains("unchecked")) {
      {/* console.log(this.parentElement.parentElement.classList); */}
      feedbackDiv.style.display = "none"
    } else {
      {/* console.log(this.parentElement.parentElement.classList); */}
      feedbackDiv.style.display = "block"
    }


  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");
    console.log(check_sections[i])

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    // check_func removes the 'unchecked' class from box
    // and updates the button text
    // subsequently recheck all possible question funcs
    // to ensure feedback gets shown or hidden as appropriate
    btn.onclick = check_func;

    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./boundary_problems_visualising_historical_boundaries.html" class="pagination-link" aria-label="Loading and Visualising the Historical Boundaries">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Loading and Visualising the Historical Boundaries</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./boundary_problems_refining_solutions.html" class="pagination-link" aria-label="(WIP) Boundary Problems - Refining Solutions">
        <span class="nav-page-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">(WIP) Boundary Problems - Refining Solutions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>